<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
			crossorigin="anonymous"
		/>
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
		/>
		<script
			defer
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
			crossorigin="anonymous"
		></script>
		<script
			defer
			src="https://kit.fontawesome.com/ae360af17e.js"
			crossorigin="anonymous"
		></script>
		<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script defer src="/js/charts.js"></script>
		<script defer src="/js/toggler.js"></script>
		<script defer src="/js/update.profile.details.js"></script>
		<script defer src="/js/disable.button.js"></script>
		<script defer src="/js/spinner2.js"></script>
		<script defer src="/js/deact-profile.js"></script>
		<script defer src="/js/previewProfilePicture.js"></script>
		<script defer src="/js/edit.button.js"></script>
		<link rel="stylesheet" type="text/css" href="/css/styles.css" />
		<link rel="icon" type="image/x-icon" href="/img/logo.png">
		<title>Profile</title>
	</head>
	<body>
		<div class="wrapper">
			<!-- Sidebar -->
			<aside id="sidebar">
				<div class="h-50">
					<div class="sidebar-logo">
						<a href="">
							<img
								src="../img/logo.png"
								class="img-thumbnail border-0"
								alt="BCA"
							/>
						</a>
					</div>
					<hr class="mx-4 mt-0" style="width: 13rem" />
					<div class="container my-2">
						<div class="row">
							<div class="col-md-4 mx-2">
								<img src="<%= person.profilePicture || '/img/default-img.jpg' %>" alt="Profile Picture" style="width: 70px; height: 65px; border-radius: 50%;" />
							</div>
							<div class="col-md-6">
								<p class="my-0 pt-2" style="font-size: 15px">
									<%= person.fname %> <%= person.lname %>
								</p>
								<span class="badge rounded-pill text-bg-info my-0 fw-normal"
									><%= person.role %></span
								>
							</div>
						</div>
					</div>
					<!-- Sidebar Navigation -->
					<ul class="sidebar-nav">
						<li class="sidebar-item">
							<a
								href="/systemAdmin/dashboard"
								class="sidebar-link collapsed"
								data-bs-target="#dashboard"
								aria-expanded="false"
								aria-controls="dashboard"
							>
								<i class="fa-solid fa-sliders pe-2"></i>
								Dashboard
							</a>
						</li>
						<li class="sidebar-item">
							<a
								href="/systemAdmin/accounts"
								class="sidebar-link"
								aria-expanded="false"
								aria-controls="users"
							>
								<i class="fa-solid fa-user pe-2"></i>
								Account Management
							</a>
						</li>
						<li class="sidebar-item">
							<a
								href="/systemAdmin/records-menu"
								class="sidebar-link"
								aria-expanded="false"
								aria-controls="pages"
							>
								<i class="fa-regular fa-file-lines pe-2"></i>
								Records Management
							</a>
						</li>
						<li class="sidebar-item">
							<a
								href="/systemAdmin/academic-year"
								class="sidebar-link"
								aria-expanded="false"
								aria-controls="auth"
							>
								<i class="fa-solid fa-archive pe-2"></i>
								Archives
							</a>
						</li>
						<li class="sidebar-item">
							<a
								href="/systemAdmin/calendar"
								class="sidebar-link collapsed"
								data-bs-target="#dashboard"
								aria-expanded="false"
								aria-controls="dashboard"
							>
								<i class="fa-regular fa-calendar pe-2"></i>
								Calendar
							</a>
						</li>
						<li class="sidebar-item">
							<a
								href="/systemAdmin/reports"
								class="sidebar-link collapsed"
								data-bs-target="#dashboard"
								aria-expanded="false"
								aria-controls="dashboard"
							>
								<i class="fa-regular fa-flag pe-2"></i>
								Reports
							</a>
						</li>
					</ul>
				</div>
			</aside>
			<!-- Main Component -->
			<div class="main">
				<nav class="navbar navbar-expand-lg px-1 border-bottom">
					<!-- Button for sidebar toggle -->
					<div class="container-fluid">
						<button class="btn" type="button" data-bs-theme="light">
							<span class="navbar-toggler-icon"></span>
						</button>
						<ul class="navbar-nav">
							<!-- Added this ul element for right-aligned items -->
							<li class="nav-item dropdown">
								<a
									class="nav-link dropdown-toggle"
									href="#"
									role="button"
									data-bs-toggle="dropdown"
									aria-expanded="false"
								>
									<span class="fa-solid fa-user pe-2"></span>
								</a>
								<ul class="dropdown-menu dropdown-menu-lg-end">
									<li>
										<a class="dropdown-item" href="/systemAdmin/profile"
											>View Profile</a
										>
									</li>
									<li>
										<a class="dropdown-item" href="/systemAdmin/historyLogs"
											>History Logs</a
										>
									</li>
									<li><hr class="dropdown-divider" /></li>
									<li>
										<a class="dropdown-item" href="/auth/logout">Logout</a>
									</li>
								</ul>
							</li>
						</ul>
					</div>
				</nav>
				<div class="container-lg">
					<h2 class="mt-2">Profile</h2>
					<hr />
					<div class="card custom-card-2 border-0">
						<div class="card-header bg-info border-0"></div>
						<div class="card-body">
							<div class="container">
								<div class="col m-0">
									<div class="container">
										<h3 class="fw-bold">Profile</h3>
										<p>Manage your profile</p>
										<hr />
										<% try { %> <%- include('../credentials/flash-message.ejs')
										%> <% } catch (error) { %>
										<div>Error: <%= error.message %></div>
										<% } %>
										<form action="">
											<div class="mt-4 mb-2">
												<label for="exampleInputEmail1" class="form-label"
													>Email address</label
												>
												<input
													type="email"
													class="form-control"
													id="exampleInputEmail1"
													aria-describedby="emailHelp"
													placeholder="<%= person.email %>"
													disabled
												/>
											</div>

											<div class="row">
												<div class="my-2 col-6">
													<label for="fname" class="form-label"
														>Last Name</label
													>
													<input
														type="text"
														class="form-control"
														id="fname"
														disabled
														placeholder="<%= person.lname %>"
													/>
												</div>
												<div class="my-2 col-6">
													<label for="fname" class="form-label"
														>First Name</label
													>
													<input
														type="text"
														class="form-control"
														id="lname"
														disabled
														placeholder="<%= person.fname %>"
													/>
												</div>
												<div class="my-2 col-6">
													<label for="role" class="form-label">Role</label>
													<input
														type="Text"
														class="form-control"
														id="role"
														placeholder="<%= person.role %>"
														disabled
													/>
												</div>
												<div class="my-2 col-6">
													<label for="role" class="form-label"
														>Class Advisory</label
													>
													<input
														type="Text"
														class="form-control"
														id="role"
														placeholder="<%= person.classAdvisory %>"
														disabled
													/>
												</div>
											</div>
										</form>
										<button
											class="btn btn-success btn-sm mt-4"
											data-bs-toggle="modal"
											data-bs-target="#editUserModal"
											onclick="populateUserForm('<%= user._id %>', '<%= user.lname %>', '<%= user.fname %>', '<%= user.role %>', '<%= user.classAdvisory %>', '<%= user.email %>')"
										>
											Edit profile
										</button>
										<button
											class="btn btn-danger btn-sm mt-4"
											data-bs-toggle="modal"
											data-bs-target="#deactivateModal"
										>
											Deactivate
										</button>
									</div>
								</div>
							</div>
						</div>
						<div class="card-footer bg-info border-0"></div>
					</div>
					<!-- ========== edit form ========== -->
					<div
						class="modal fade"
						id="editUserModal"
						data-bs-backdrop="static"
						data-bs-keyboard="false"
						tabindex="-1"
						aria-labelledby="editRecordModalLabel"
						aria-hidden="true"
					>
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header bg-info">
									<h5 class="modal-title" id="editRecordModalLabel">
										Edit Account details
									</h5>
									<button
										type="button"
										class="btn-close"
										data-bs-dismiss="modal"
										aria-label="Close"
									></button>
								</div>
								<div class="modal-body">
									<form id="editUserForm" action="" method="post">
										<!-- <div class="col-md-2" style="position: relative;">
											<label for="profilePicture" class="mb-3" style="cursor: pointer; position: relative;">
												<img id="profilePicturePreview" src="<%= person.profilePicture %>" alt="Preview" style="width: 100px; height: 100px; margin-bottom: 10px; border-radius: 50%;" />
												<input type="file" class="form-control" name="profilePicture" id="profilePicture" accept="image/*" onchange="previewProfilePicture(event)" style="display: none;" />
												<span class="material-symbols-outlined edit-icon" style="position: absolute; top: 0; right: 0; background-color: rgba(255, 255, 255, 0.8); padding: 5px; border-radius: 50%;">edit</span>
											</label>
										</div> -->
										<div class="form-floating mb-3">
											<input
												type="text"
												class="form-control"
												name="editLName"
												id="editLName"
												required
											/>
											<label for="editLName">Last Name</label>
										</div>
										<div class="form-floating mb-3">
											<input
												type="text"
												class="form-control"
												name="editFName"
												id="editFName"
												required
											/>
											<label for="editFName">First Name</label>
										</div>
										<div class="form-floating mb-3">
											<input
												type="email"
												class="form-control"
												name="editEmail"
												id="editEmail"
												required
											/>
											<label for="editEmail">Email</label>
										</div>
										<div class="form-floating mb-3">
											<select
												class="form-select"
												name="editRole"
												id="editRole"
												onchange="updateAdvisoryOptions()"
												required
											>
												<option value="System Admin">System Admin</option>
												<option value="Admin">Admin</option>
												<option value="Class Advisor">Class Advisor</option>
											</select>
											<label for="editRole">Role</label>
											<div
												class="form-text form-text-sm"
												style="font-size: 12px; padding-left: 8px"
											>
												Please note that changing your role will automatically
												log you out.
											</div>
										</div>
										<div class="form-floating mb-3">
											<select
												class="form-select"
												name="editClassAdvisory"
												id="editClassAdvisory"
												required
												onchange="updateSubjectAdvisory()"
											>
												<option value=""></option>
												<option value="None">None</option>
												<option value="Kinder">Kinder</option>
												<option value="Grade 1">Grade 1</option>
												<option value="Grade 2">Grade 2</option>
												<option value="Grade 3">Grade 3</option>
												<option value="Grade 4">Grade 4</option>
												<option value="Grade 5">Grade 5</option>
												<option value="Grade 6">Grade 6</option>
											</select>
											<label for="editClassAdvisory">Class Advisory</label>
										</div>
										<div class="d-flex justify-content-end">
											<button
												type="submit"
												id="submitButton"
												class="btn btn-success"
											>
												<span
													class="spinner-border spinner-border-sm d-none"
													role="status"
													aria-hidden="true"
												></span>
												Update
											</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
					<!-- ========== End modal ========== -->
					<!-- Modal -->
					<div
						class="modal fade"
						id="deactivateModal"
						data-bs-backdrop="static"
						data-bs-keyboard="false"
						tabindex="-1"
						aria-labelledby="deactivateModalLabel"
						aria-hidden="true"
					>
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header bg-info">
									<h5 class="modal-title" id="deactivateModalLabel">
										Confirm Deactivation
									</h5>
									<button
										type="button"
										class="btn-close"
										data-bs-dismiss="modal"
										aria-label="Close"
									></button>
								</div>
								<div class="modal-body m-0">
									<h3>Are you sure you want to deactivate your account?</h3>
									<hr />
									<p class="m-0" style="font-size: 14px">
										<strong>Note:</strong> You will not be able to deactivate
										your account if you are the only system admin. 
									</p>
								</div>
								<div class="modal-footer">
									<button
										type="button"
										class="btn btn-sm btn-secondary"
										data-bs-dismiss="modal"
									>
										Cancel
									</button>
									<button
										type="button"
										class="btn btn-sm btn-danger"
										onclick="deactivateAccount()"
									>
										Deactivate
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			// JavaScript function to populate the edit form
			function populateUserForm(_id, lname, fname, role, classAdvisory, email) {
				document
					.getElementById('editUserForm')
					.setAttribute('action', `/systemAdmin/edit-profile/${_id}`);
				document.getElementById('editLName').value = lname;
				document.getElementById('editFName').value = fname;
				document.getElementById('editEmail').value = email;
				document.getElementById('editRole').value = role;
				document.getElementById('editClassAdvisory').value = classAdvisory;
			}
		</script>
	</body>
</html>
